-- TRIGGER 2
CREATE TRIGGER DANHNHAU
ON DOIDAU
AFTER INSERT
AS
BEGIN
	UPDATE NGUOICHOI 
	SET TONGSOTRAN = TONGSOTRAN + 1 FROM inserted, NGUOICHOI
	WHERE INSERTED.PLAYER1_ID = NGUOICHOI.PLAYER_ID

	UPDATE NGUOICHOI 
	SET TONGSOTRAN = TONGSOTRAN + 1 FROM inserted, NGUOICHOI
	WHERE INSERTED.PLAYER2_ID = NGUOICHOI.PLAYER_ID
	
	DECLARE @thang INT
	SELECT @thang = I.WINNER FROM INSERTED AS I

	IF (@thang = 0) 
	UPDATE NGUOICHOI
	SET CHISOTHANG = CHISOTHANG + 1 FROM inserted, NGUOICHOI
	WHERE INSERTED.PLAYER1_ID = NGUOICHOI.PLAYER_ID

	ELSE IF (@thang = 1) 
	UPDATE NGUOICHOI
	SET CHISOTHANG = CHISOTHANG + 1 FROM inserted, NGUOICHOI
	WHERE INSERTED.PLAYER2_ID = NGUOICHOI.PLAYER_ID
END

-- Thu ket qua trigger
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00001', 675458, 516873, '2021-05-11 10:36:39', '2021-05-11 10:40:47', '00:04:08', 0); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00002', 489087, 289250, '2021-05-10 12:10:43', '2021-05-10 12:15:28', '00:04:45', 0);
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES 
		('TD_00003', 579046, 802764, '2021-04-09 03:08:45', '2021-04-09 03:13:28', '00:04:43', 0); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00004', 862670, 651479, '2021-04-30 23:39:20', '2021-04-30 23:43:02', '00:03:42', 0); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00005', 485823, 780585, '2021-03-21 04:08:36', '2021-03-21 04:11:53', '00:03:17', 0); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00006', 932344, 413997, '2021-05-12 04:25:20', '2021-05-12 04:29:02', '00:03:42', 0); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00007', 826393, 254693, '2021-04-25 10:28:41', '2021-04-25 10:32:47', '00:04:06', 0); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00008', 450318, 891952, '2021-05-13 17:47:04', '2021-05-13 17:50:44', '00:03:40', 0); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00009', 239034, 199602, '2021-04-09 15:17:34', '2021-04-09 15:22:32', '00:04:58', 0); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00010', 117733, 190837, '2021-04-17 15:55:34', '2021-04-17 15:58:36', '00:03:02', 0); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00011', 364837, 831847, '2021-03-29 07:26:34', '2021-03-29 07:30:11', '00:03:37', 0);
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES 
		('TD_00012', 960812, 719356, '2021-05-08 13:10:05', '2021-05-08 13:13:27', '00:03:22', 0); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00013', 960812, 180666, '2021-03-15 00:07:48', '2021-03-15 00:12:08', '00:04:20', 0); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00014', 960812, 738653, '2021-05-10 05:19:29', '2021-05-10 05:23:24', '00:03:55', 0); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00015', 180666, 116100, '2021-04-25 12:07:57', '2021-04-25 12:12:16', '00:04:19', 0); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00016', 738653, 626506, '2021-04-04 16:36:06', '2021-04-04 16:39:06', '00:03:00', 0); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00017', 467329, 876514, '2021-03-02 14:39:16', '2021-03-02 14:42:21', '00:03:05', 0); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00018', 489087, 450318, '2021-03-23 16:00:29', '2021-03-23 16:03:49', '00:03:20', 0); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00019', 254693, 932344, '2021-03-28 02:14:57', '2021-03-28 02:18:01', '00:03:04', 0); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00020', 190837, 413997, '2021-05-02 12:32:36', '2021-05-02 12:35:55', '00:03:19', 0); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00021', 579046, 116100, '2021-04-30 03:15:08', '2021-04-30 03:18:41', '00:03:33', 0); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00022', 485823, 738653, '2021-03-03 05:56:07', '2021-03-03 06:00:02', '00:03:55', 0); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00023', 364837, 239034, '2021-04-20 21:37:26', '2021-04-20 21:42:24', '00:04:58', 0); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00024', 467329, 180666, '2021-05-10 06:11:46', '2021-05-10 06:15:34', '00:03:48', 0); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00025', 199602, 289250, '2021-04-01 08:49:51', '2021-04-01 08:54:08', '00:04:17', 1); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00026', 780585, 719356, '2021-05-08 16:12:44', '2021-05-08 16:17:29', '00:04:45', 1); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00027', 891952, 862670, '2021-04-20 15:56:00', '2021-04-20 16:00:40', '00:04:40', 1); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00028', 802764, 516873, '2021-03-31 22:16:42', '2021-03-31 22:19:51', '00:03:09', 1); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00029', 826393, 960812, '2021-04-15 00:40:16', '2021-04-15 00:45:09', '00:04:53', 1); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00030', 831847, 626506, '2021-03-28 12:26:49', '2021-03-28 12:30:21', '00:03:32', 1); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00031', 675458, 876514, '2021-05-18 01:23:03', '2021-05-18 01:27:45', '00:04:42', 1); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00032', 651479, 117733, '2021-03-01 21:04:31', '2021-03-01 21:08:09', '00:03:38', 1); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00033', 579046, 364837, '2021-03-07 04:21:57', '2021-03-07 04:25:15', '00:03:18', 1); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00034', 180666, 626506, '2021-04-05 02:14:52', '2021-04-05 02:18:56', '00:04:04', 1); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00035', 516873, 831847, '2021-05-06 05:02:00', '2021-05-06 05:06:08', '00:04:08', 1); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00036', 675458, 802764, '2021-05-10 12:55:35', '2021-05-10 12:58:54', '00:03:19', 1); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00037', 413997, 239034, '2021-04-21 14:59:51', '2021-04-21 15:03:56', '00:04:05', 1); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00038', 862670, 450318, '2021-03-05 09:12:41', '2021-03-05 09:17:41', '00:05:00', 0); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00039', 190837, 876514, '2021-03-19 12:02:02', '2021-03-19 12:05:11', '00:03:09', 0); 
INSERT INTO DOIDAU
	(TRANDAU_ID, PLAYER1_ID, PLAYER2_ID, START_TIME, END_TIME, DURATION, WINNER) VALUES
		('TD_00040', 891952, 489087, '2021-03-07 04:12:38', '2021-03-07 04:16:56', '00:04:18', 0); 
